<!DOCTYPE HTML>
<html
        xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{layout/layoutGamestudio.html}"
        lang="sk">
<head>
    <title>Gamestudio - Kamene</title>
</head>
<body id="body">
<main layout:fragment="content">
    <h2>Database search</h2>



    <section>
           <div>
            <table class="scores">
                <thead>
                <tr>
                    <th>Id</th>
                    <th>Title</th>
                    <th>Code</th>
                </tr>


                </thead>
                <h3>Komentare</h3>

                <tbody id="citiesTable">
                </tbody>
            </table>
        </div>
    </section>



    <script type="text/javascript">

        let elements = {

            cities: document.getElementById("citiesTable")
        };



         fetchAndRenderCities("/api/databaseSearch/getCities", elements);
        //---------------------fetching
        function fetchAndRenderCities(url, elements) {
            fetch(url)  //there may be a second parameter, an object wih options, but we do not need it now.
                .then(response => {      //fetch promise fullfilled (operation completed successfully)
                    if (response.ok) {    //successful execution includes an error response from the server. So we have to check the return status of the response here.
                        return response.json(); //we return a new promise with the response data as a js object, constructed from the JSON string in the response
                    } else { //if we get server error
                        return Promise.reject(new Error(`Cities acquisition failed. Server answered with ${response.status}: ${response.statusText}.`)); //we return a rejected promise to be catched later
                    }
                })
                .then(cities => { //here we process the returned response data in JSON ...
                    console.log(cities);
                    renderCities(cities, elements);
                })
                .catch(error => { ////here we process all the failed promises
                    errorMessage = "Nepodarilo sa získať alebo zobraziť komentáre. Podrobnosti: " + error;
                    // console.log(errorMessage);
                    elements.scoresTableBody.innerHTML = errorMessage;
                });
        }


        //-------------------rendering
        function renderCities(cities, elements) {
            const rowCount = cities.length;
            let htmlToRender = "";

            for (row = 0; row < rowCount; row++) {
                htmlToRender +=
                    `<tr>
                        <td>${cities[row].id}</td>
                        <td>${cities[row].title}</td>
                        <td>${cities[row].code}</td>
                    </tr>`;
            }

            elements.cities.innerHTML = htmlToRender;
        }



    </script>

</main>
</body>
</html>